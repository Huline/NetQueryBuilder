<UserControl x:Class="NetQueryBuilder.WPF.Controls.QueryBuilder"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:NetQueryBuilder.WPF.Controls"
             xmlns:ui="clr-namespace:NetQueryBuilder.WPF.Controls.UI">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="16">
            <!-- SELECT Section -->
            <GroupBox Header="SELECT - Choose Fields" Margin="0,0,0,16">
                <StackPanel>
                    <!-- Action Buttons -->
                    <StackPanel Orientation="Horizontal" Margin="0,8,0,8">
                        <Button Content="Select All"
                                Command="{Binding SelectAllFieldsCommand}"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Margin="0,0,8,0"/>
                        <Button Content="Clear All"
                                Command="{Binding ClearAllFieldsCommand}"
                                Style="{StaticResource SecondaryButtonStyle}"/>
                    </StackPanel>

                    <!-- Property List -->
                    <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding SelectableProperties}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding IsSelected, Converter={StaticResource BooleanToBackgroundConverter}}"
                                            Padding="8,4"
                                            Margin="0,2">
                                        <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}">
                                            <StackPanel>
                                                <TextBlock Text="{Binding Property.DisplayName}" FontWeight="SemiBold"/>
                                                <TextBlock Text="{Binding Property.PropertyType.Name}"
                                                          FontSize="10"
                                                          Foreground="Gray"/>
                                            </StackPanel>
                                        </CheckBox>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </StackPanel>
            </GroupBox>

            <!-- WHERE Section -->
            <GroupBox Header="WHERE - Define Conditions" Margin="0,0,0,16">
                <local:ConditionEditor Query="{Binding Query}"
                                      Condition="{Binding Query.Condition}"
                                      IndentationLevel="0"/>
            </GroupBox>

            <!-- Expression Preview Section -->
            <GroupBox Header="Generated Expression" Margin="0,0,0,16"
                     Visibility="{Binding ExpressionPreview, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Invert}">
                <ui:ExpressionPreview Expression="{Binding ExpressionPreview}"/>
            </GroupBox>

            <!-- Execute Button -->
            <Button Command="{Binding ExecuteQueryCommand}"
                    Style="{StaticResource PrimaryButtonStyle}"
                    HorizontalAlignment="Right"
                    Padding="24,12"
                    FontSize="14"
                    FontWeight="Bold">
                <StackPanel Orientation="Horizontal">
                    <Path Data="M8 5v14l11-7z"
                          Fill="White"
                          Stretch="Uniform"
                          Width="16" Height="16"
                          Margin="0,0,8,0"/>
                    <TextBlock Text="Execute Query" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>

            <!-- Results Section (will be populated by QueryResultGrid externally) -->
        </StackPanel>
    </ScrollViewer>
</UserControl>
