@using NetQueryBuilder.Blazor.Components.Conditions
@using NetQueryBuilder.Properties
@typeparam TEntity where TEntity : class

<div class="nqb-paper" style="padding: 32px; margin-bottom: 32px; box-shadow: var(--nqb-shadow-md);">
    <div class="nqb-grid nqb-grid-cols-1" style="gap: 32px;">
        <div>
            <h5 class="nqb-text-h5 nqb-text-primary" style="margin-bottom: 24px;">SELECT</h5>
            <div class="nqb-form-control">
                <label class="nqb-label">Select fields</label>
                <div style="border: 1px solid var(--nqb-border-color); border-radius: var(--nqb-border-radius); padding: 12px;">
                    @foreach (var property in _selectedPropertyPaths)
                    {
                        <label class="nqb-checkbox-wrapper" style="display: block; margin-bottom: 8px;">
                            <input type="checkbox" class="nqb-checkbox" 
                                   checked="@property.IsSelected" 
                                   @onchange="@(e => TogglePropertySelection(property, (bool)e.Value!))" />
                            <span>@property.Property.DisplayName()</span>
                        </label>
                    }
                </div>
            </div>
        </div>

        <div style="margin-top: 32px;">
            <h5 class="nqb-text-h5 nqb-text-primary" style="margin-bottom: 24px;">WHERE</h5>
            <div class="nqb-paper nqb-paper-outlined" style="padding: 24px; margin-bottom: 24px;">
                <CascadingValue Value="@_query">
                    <ConditionComponent Condition="@_query.Condition"/>
                </CascadingValue>
            </div>
        </div>

        <div style="display: flex; justify-content: center; margin-top: 32px;">
            <Button Color="primary" Variant="filled" Size="large" OnClick="RunQuery">
                <Icon Name="play-arrow" /> Run Query
            </Button>
        </div>
    </div>
</div>

<div class="nqb-paper" style="padding: 32px; box-shadow: var(--nqb-shadow-md);">
    <h5 class="nqb-text-h5 nqb-text-primary" style="margin-bottom: 24px;">RÉSULTATS</h5>
    <QueryResultTable @ref="_queryResult" TEntity="TEntity" Properties="_selectedPropertyPaths" TotalItems="_totalItems" />
</div>