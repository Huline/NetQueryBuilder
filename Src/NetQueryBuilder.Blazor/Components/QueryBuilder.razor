@using NetQueryBuilder.Blazor.Components.Conditions
@typeparam TEntity where TEntity : class

<MudStack Spacing="10">
    <div>
        <MudText Typo="Typo.h5">SELECT</MudText>
        <div class="form-group">
            <label>Sélectionner les champs</label>
            <div class="custom-multiselect">
                @foreach (var property in _selectedPropertyPaths)
                {
                    <div class="custom-checkbox">
                        <input type="checkbox"
                               id="@($"prop_{property.Property.DisplayName()}")"
                               checked="@property.IsSelected"
                               @onchange="(e) => OnPropertySelectionChanged(property, e)" />
                        <label for="@($"prop_{property.Property.DisplayName()}")">
                            @property.Property.DisplayName()
                        </label>
                    </div>
                }
            </div>
        </div>

    </div>

    <div>
        <MudText Typo="Typo.h5" GutterBottom="true">WHERE</MudText>
        <CascadingValue Value="@_query">
            <ConditionComponent Condition="@_query.Condition"/>
        </CascadingValue>
        <MudItem xs="4" lg="4">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">_lambda Expression</MudText>
                    </CardHeaderContent>
                    <CardHeaderActions>
                        <MudIconButton Icon="@Icons.Material.Filled.CopyAll" Color="Color.Default"/>
                    </CardHeaderActions>
                </MudCardHeader>
                <MudCardContent>
                    <code>@Expression</code>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </div>

    <div>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="RunQuery">Run Query</MudButton>
    </div>

    <MudTable Items="_data" Bordered="true" Striped="true">
        <HeaderContent>
            @foreach (var property in _selectedPropertyPaths)
            {
                <MudTh>@property.Property.DisplayName()</MudTh>
            }
        </HeaderContent>
        <RowTemplate>
            @foreach (var propertyPath in _selectedPropertyPaths)
            {
                <MudTd>@propertyPath.Property.DisplayValue(context)</MudTd>
            }
        </RowTemplate>
    </MudTable>
</MudStack>