@using NetQueryBuilder.Blazor.Components.Conditions
@typeparam TEntity where TEntity : class

<MudPaper Elevation="3" Class="pa-4 mb-4">
    <MudGrid>
        <MudItem xs="12">
            <MudText Typo="Typo.h5" Color="Color.Primary" Class="mb-3">SELECT</MudText>
            <MudSelect Label="Select fields" T="SelectPropertyPath"
                       SelectedValues="_selectedPropertyPaths.Where(s => s.IsSelected)"
                       SelectedValuesChanged="SelectedValuesChanged"
                       MultiSelection="true" SelectAll="true"
                       AdornmentIcon="@Icons.Material.Filled.Checklist"
                       AdornmentColor="Color.Primary"
                       ToStringFunc="@(prop => prop!.Property.DisplayName())">
                @foreach (var property in _selectedPropertyPaths)
                {
                    <MudSelectItem T="SelectPropertyPath" Value="property">
                        @property.Property.DisplayName()
                    </MudSelectItem>
                }
            </MudSelect>
        </MudItem>

        <MudItem xs="12" Class="mt-4">
            <MudText Typo="Typo.h5" Color="Color.Primary" Class="mb-3">WHERE</MudText>
            <MudPaper Elevation="0" Class="pa-3 mb-3" Style="border: 1px solid var(--mud-palette-lines-default);">
                <CascadingValue Value="@_query">
                    <ConditionComponent Condition="@_query.Condition"/>
                </CascadingValue>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" Class="d-flex justify-center mt-4">
            <MudButton Color="Color.Primary" Variant="Variant.Filled"
                       StartIcon="@Icons.Material.Filled.PlayArrow"
                       Size="Size.Large"
                       OnClick="RunQuery">Run Query
            </MudButton>
        </MudItem>
    </MudGrid>
</MudPaper>

<MudPaper Elevation="3" Class="pa-4">
    <MudText Typo="Typo.h5" Color="Color.Primary" Class="mb-3">RÉSULTATS</MudText>
    <QueryResultTable @ref="_queryResult" TEntity="TEntity" Data="_data" Properties="_selectedPropertyPaths" TotalItems="_totalItems"/>
</MudPaper>