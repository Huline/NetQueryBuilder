@using System.Linq.Expressions
@using NetQueryBuilder.Conditions
<MudStack Row Spacing="4">
    <MudItem xs="8" lg="8">
        <RelationalPredicateField Condition="@Condition"></RelationalPredicateField>
        <RelationalOperators Condition="@Condition"></RelationalOperators>
        <RelationalValue Condition="@Condition"></RelationalValue>
    </MudItem>
</MudStack>

@code {
    [Parameter] public LogicalCondition Condition { get; set; }

    [Parameter] public ParameterExpression Parameter { get; set; }

    [Parameter] public Action<Expression> OnChanged { get; set; }

    protected override void OnInitialized()
    {
    }

    private void OnChangeBody(Expression body)
    {
        OnChanged(body);
    }

    private void ChangeLeft(Expression left)
    {
        Condition.Left = left;
        OnChanged(Condition.Compile());
    }

    private void ChangeRight(Expression right)
    {
        Condition.Right = right;
        OnChanged(Condition.Compile());
    }

    private void ChangeOperator(string op)
    {
        var expressionType = (ExpressionType)Enum.Parse(typeof(ExpressionType), op);
        var operators = Condition.AvailableOperatorsForCurrentProperty();
        Condition.Operator = operators.FirstOrDefault(o => o.ExpressionType == expressionType) ?? operators.First();
        ;
        OnChanged(Condition.Compile());
    }

    private void RemoveLeft()
    {
        //OnChanged(PredicateExpression.Right.Copy());
    }

    private void RemoveRight()
    {
        //OnChanged(PredicateExpression.Left.Copy());
    }

}